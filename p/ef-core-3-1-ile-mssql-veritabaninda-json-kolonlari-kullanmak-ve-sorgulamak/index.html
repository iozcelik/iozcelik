<!doctype html><html lang=tr-tr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MSSQL 2016 ile desteklenmeye başlayan JSON kolonlar çok faydalı olmasına rağmen şu anda Entity Framework Core üzerinden sorgulanamıyor durumda.
Bu durum ise bir çok yazılımcı için bu kolonları nasıl saklayacağı ve sorgulayacağı gibi soruları akıllara getirmektedir.
EF Core kullanmaya başladıktan sonra kendimi tekrar etmemek adına yazdığım kodları paket haline getirip, NUGET paket yöneticisine yükledim."><title>EF Core 3.1 ile MSSQL veritabanında JSON kolonları kullanmak ve sorgulamak</title><link rel=canonical href=https://ismailozcelik.com/p/ef-core-3-1-ile-mssql-veritabaninda-json-kolonlari-kullanmak-ve-sorgulamak/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="EF Core 3.1 ile MSSQL veritabanında JSON kolonları kullanmak ve sorgulamak"><meta property="og:description" content="MSSQL 2016 ile desteklenmeye başlayan JSON kolonlar çok faydalı olmasına rağmen şu anda Entity Framework Core üzerinden sorgulanamıyor durumda.
Bu durum ise bir çok yazılımcı için bu kolonları nasıl saklayacağı ve sorgulayacağı gibi soruları akıllara getirmektedir.
EF Core kullanmaya başladıktan sonra kendimi tekrar etmemek adına yazdığım kodları paket haline getirip, NUGET paket yöneticisine yükledim."><meta property="og:url" content="https://ismailozcelik.com/p/ef-core-3-1-ile-mssql-veritabaninda-json-kolonlari-kullanmak-ve-sorgulamak/"><meta property="og:site_name" content="İsmail Özçelik"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="ef-core"><meta property="article:tag" content="json"><meta property="article:published_time" content="2020-07-15T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-15T00:00:00+00:00"><meta name=twitter:site content="ismailozcelik"><meta name=twitter:title content="EF Core 3.1 ile MSSQL veritabanında JSON kolonları kullanmak ve sorgulamak"><meta name=twitter:description content="MSSQL 2016 ile desteklenmeye başlayan JSON kolonlar çok faydalı olmasına rağmen şu anda Entity Framework Core üzerinden sorgulanamıyor durumda.
Bu durum ise bir çok yazılımcı için bu kolonları nasıl saklayacağı ve sorgulayacağı gibi soruları akıllara getirmektedir.
EF Core kullanmaya başladıktan sonra kendimi tekrar etmemek adına yazdığım kodları paket haline getirip, NUGET paket yöneticisine yükledim."></head><body><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Menüyü Gizle">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hubbbf2ad576efa7b07d3288713394c29c_4009_96x0_resize_box_2.png width=96 height=96 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>💻</span></figure><h1 class=site-name><a href=https://ismailozcelik.com/>İsmail Özçelik</a></h1><h2 class=site-description>Biraz yazınca blog olacak</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Anasayfa</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>Hakkımda</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Arşiv</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Arama</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Koyu Mod</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://ismailozcelik.com/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/yazilim/ style=background-color:#2a9d8f;color:#fff>Yazılım</a></header><h2 class=article-title><a href=/p/ef-core-3-1-ile-mssql-veritabaninda-json-kolonlari-kullanmak-ve-sorgulamak/>EF Core 3.1 ile MSSQL veritabanında JSON kolonları kullanmak ve sorgulamak</a></h2><h3 class=article-subtitle>MSSQL 2016 ile desteklenmeye başlayan JSON kolonlar çok faydalı olmasına rağmen şu anda Entity Framework Core üzerinden sorgulanamıyor durumda.
Bu durum ise bir çok yazılımcı için bu kolonları nasıl saklayacağı ve sorgulayacağı gibi soruları akıllara getirmektedir.
EF Core kullanmaya başladıktan sonra kendimi tekrar etmemek adına yazdığım kodları paket haline getirip, NUGET paket yöneticisine yükledim.</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>15/07/2020</time></footer></div></header><section class=article-content><p>MSSQL 2016 ile desteklenmeye başlayan JSON kolonlar çok faydalı olmasına rağmen şu anda Entity Framework Core üzerinden sorgulanamıyor durumda.</p><p>Bu durum ise bir çok yazılımcı için bu kolonları nasıl saklayacağı ve sorgulayacağı gibi soruları akıllara getirmektedir.</p><p>EF Core kullanmaya başladıktan sonra kendimi tekrar etmemek adına yazdığım kodları paket haline getirip, NUGET paket yöneticisine yükledim. (<a class=link href=https://github.com/iozcelik/EntityFrameworkCore.SqlServer.JsonExtention target=_blank rel=noopener>GitHub</a> | <a class=link href=https://www.nuget.org/packages/EntityFrameworkCore.SqlServer.JsonExtention/1.0.0 target=_blank rel=noopener>Nuget</a>)</p><p>Paketin kullanımı kolay, EF Core tarafından desteklenen diğer DBFunction kullanım şekliyle aynı.</p><p>Paketi Nuget üzerinden yüklemek için “Packet Manager Console” üzerinden aşağıdaki komutu çalıştırmamız gerekiyor.</p><pre><code class=language-console data-lang=console>PM&gt; Install-Package EntityFrameworkCore.SqlServer.JsonExtention -Version 1.0.0
</code></pre><p>Paket projemize dahil olduktan sonra ise DbContext class’ında bulunan OnConfiguring metodunu override ediyoruz ve bu pakete ekliyoruz.</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=k>protected</span> <span class=k>override</span> <span class=k>void</span> <span class=n>OnConfiguring</span><span class=p>(</span><span class=n>DbContextOptionsBuilder</span> <span class=n>optionsBuilder</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>base</span><span class=p>.</span><span class=n>OnConfiguring</span><span class=p>(</span><span class=n>optionsBuilder</span><span class=p>);</span>
    <span class=n>optionsBuilder</span><span class=p>.</span><span class=n>UseJsonFunctions</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div><p>Artık Json fonksiyonlarını projemizde kullanabiliriz.</p><p>Peki bir kolonun Json olduğunu nasıl belirteceğiz? Onun içinde model builder da ilgili kolon için <code>.HasJsonConversion</code> metodunu kullanacağız. Örneğin;</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=k>protected</span> <span class=k>override</span> <span class=k>void</span> <span class=n>OnModelCreating</span><span class=p>(</span><span class=n>ModelBuilder</span> <span class=n>modelBuilder</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>modelBuilder</span><span class=p>.</span><span class=n>Entity</span><span class=p>&lt;</span><span class=n>Customer</span><span class=p>&gt;().</span><span class=n>Property</span><span class=p>(</span><span class=n>p</span> <span class=p>=&gt;</span> <span class=n>p</span><span class=p>.</span><span class=n>Company</span><span class=p>).</span><span class=n>HasJsonConversion</span><span class=p>();</span>
    <span class=n>modelBuilder</span><span class=p>.</span><span class=n>Entity</span><span class=p>&lt;</span><span class=n>Customer</span><span class=p>&gt;().</span><span class=n>Property</span><span class=p>(</span><span class=n>p</span> <span class=p>=&gt;</span> <span class=n>p</span><span class=p>.</span><span class=n>ContactDetail</span><span class=p>).</span><span class=n>HasJsonConversion</span><span class=p>();</span>
    <span class=n>modelBuilder</span><span class=p>.</span><span class=n>Entity</span><span class=p>&lt;</span><span class=n>Customer</span><span class=p>&gt;().</span><span class=n>Property</span><span class=p>(</span><span class=n>p</span> <span class=p>=&gt;</span> <span class=n>p</span><span class=p>.</span><span class=n>LuckyNumbers</span><span class=p>).</span><span class=n>HasJsonConversion</span><span class=p>();</span>
    <span class=n>modelBuilder</span><span class=p>.</span><span class=n>Entity</span><span class=p>&lt;</span><span class=n>Customer</span><span class=p>&gt;().</span><span class=n>Property</span><span class=p>(</span><span class=n>p</span> <span class=p>=&gt;</span> <span class=n>p</span><span class=p>.</span><span class=n>MenuItems</span><span class=p>).</span><span class=n>HasJsonConversion</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div><p>Son olarak ise nasıl sorgulayacağımıza bakalım;</p><div class=highlight><pre class=chroma><code class=language-csharp data-lang=csharp><span class=kt>var</span> <span class=n>phones</span> <span class=p>=</span> <span class=n>_context</span><span class=p>.</span><span class=n>Customers</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>w</span> <span class=p>=&gt;</span> <span class=n>EF</span><span class=p>.</span><span class=n>Functions</span><span class=p>.</span><span class=n>JsonValue</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=n>ContactDetail</span><span class=p>,</span> <span class=s>&#34;Phone&#34;</span><span class=p>)</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span>
        <span class=p>.</span><span class=n>OrderByDescending</span><span class=p>(</span><span class=n>o</span> <span class=p>=&gt;</span> <span class=n>EF</span><span class=p>.</span><span class=n>Functions</span><span class=p>.</span><span class=n>JsonValue</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=n>ContactDetail</span><span class=p>,</span> <span class=s>&#34;Phone&#34;</span><span class=p>))</span>
        <span class=p>.</span><span class=n>Select</span><span class=p>(</span><span class=n>s</span> <span class=p>=&gt;</span> <span class=n>EF</span><span class=p>.</span><span class=n>Functions</span><span class=p>.</span><span class=n>JsonValue</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>ContactDetail</span><span class=p>,</span> <span class=s>&#34;Phone&#34;</span><span class=p>))</span>
        <span class=p>.</span><span class=n>ToList</span><span class=p>();</span>
</code></pre></div><p>Evet, tüm kullanım bu şekilde. Umarım Entity Framework doğal Json desteğini ekleyene kadar herkese faydalı olur.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/ef-core/>ef-core</a>
<a href=/tags/json/>json</a></section></footer></article><aside class=related-contents--wrapper></aside><footer class=site-footer><section class=copyright>&copy;
2020 İsmail Özçelik</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> ile oluşturuldu.<br><b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.0.0>Stack</a></b> teması <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> tarafından tasarlandı</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>